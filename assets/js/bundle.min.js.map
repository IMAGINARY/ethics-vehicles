{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/js/car.js","src/js/constants.js","src/js/countdown-button.js","src/js/design.js","src/js/info-boxes.js","src/js/info-positions.js","src/js/lane.js","src/js/lanes.js","src/js/main.js","src/js/menu.js","src/js/pixi-help.js","src/js/policies.js","src/js/report.js","src/js/scene-element.js","src/js/situation-runner.js","src/js/situation.js","src/js/situations/car-enters-lane.js","src/js/situations/child-runs.js","src/js/situations/tree-falls.js","src/js/style-help.js","src/js/texts.js","src/js/view.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","_constants","_pixiHelp","_lane","Car","view","imageFile","lane","arguments","undefined","NO_LANE","_classCallCheck","this","sprite","createSprite","CAR_SCALE","zIndex","position","forceDirection","x","start","end","y","forceLaneDirection","angle","getDrivingAngle","_this","endPosition","time","easing","TWEEN","Easing","Linear","None","stopPosition","getPositionCoordinates","Promise","resolve","Tween","to","onComplete","offsetPosition","_this2","offsetAngle","placeInLane","oppositeLane","getCarPosition","container","addChild","removeChild","width","height","STREET_WIDTH","CountdownButton","text","onClick","htmlButton","$","htmlText","on","doClick","show","timeoutRunner","window","onkeydown","event","which","clearTimeout","hide","timeout","Math","floor","setTimeout","_styleHelp","InfoBox","htmlElement","Boxes","forEach","box","index","element","querySelector","innerText","name","innerHTML","description","setLeftTopCSSFromCoord","infopos","tweenOpacity","get","map","html","InfoPos","TopLeft","TopRight","BottomRight","BottomLeft","PIXI","Point","Lerp","k","Lane","vectorBetweenPoints","car","isVertical","POINT_ZERO","createHorizontalLane","verticalOffset","dirMultiplier","ViewSize","createVerticalLane","horizontalOffset","LANES","StreetOffsetFromCenter","STREET_LANE_OFFSET","setOppositeLanes","laneA","laneB","_view","Menu","elementId","optionsArray","title","menuClass","currentOption","visible","options","Array","from","buttons","titleText","concat","optionsArea","find","cursor","createHTMLOptions","removeClass","addClass","select","up","down","enterOption","updateCursorPosition","fadeInCursor","clearHTML","domCursor","style","opacity","then","click","action","button","append","empty","deselect","css","sourceImages","scale","anchor","textures","image","Texture","AnimatedSprite","set","sourceImage","texture","Sprite","color","graphics","Graphics","lineStyle","drawCircle","max","b","v1","v2","atan2","PI","pos","screenPosFromFraction","toOpacity","alpha","Quadratic","Out","dest","_texts","Policies","_objectSpread","id","Texts","Humanist","Profit","Protector","Report","situationDescriptionElement","policyBlock","policyNameElement","policyObjectiveElement","decisionBlock","decisionElement","display","classList","remove","add","situation","getDescription","policy","objective","decision","SceneElement","initialPosition","setSprite","reset","pixiFadeIn","_policies","_menu","_interopRequireDefault","_countdownButton","_infoBoxes","_design","SituationRunner","report","currentDecision","tempElements","currentPolicy","policyMenu","agentCar","setup","wait","showElementsInfo","getElements","setSituation","waitForAdvanceButton","Next","waitForPolicy","setPolicy","hideElementsInfo","playOutDecision","setDecision","Restart","clearSprites","teardown","getDecision","ChoosePolicy","elements","_this3","promise","highlight","fadeShow","_this4","removeTempElements","hideAll","actionFunction","addTempElement","highlightSprite","HighlightColor","push","_this5","Situation","sprites","key","aSituation","situations","aSprite","policyId","getDecisions","HighlightAgentColor","HighlightOthersColor","_sceneElement","_situation","_car","_lanes","_infoPositions","BUS_STOP_X","BorderBlockSize","SPRITE_WIDTH","BUS_STOP_Y","BlackCarCrossVector","BlackCarCrashVector","AgentCrashVector","TurnLeftVector","TurnRightVector","CarEntersLaneSituation","_possibleConstructorReturn","_getPrototypeOf","agentLane","parkedLane","blackCar","truck","busStop","CarEntersLane","fadeIn","moveTruckInPosition","all","moveBlackCarInPosition","moveAgentInPosition","AutonomousCar","LuxuryCar","left","Truck","right","BusStop","humanist","decisionAdvace","profit","decisionTurnLeft","protector","decisionTurnRight","advanceAndTurn","moveBlackCarToFinalPosition","addSprite","driveInLaneUntilPosition","Cubic","Sinusoidal","BLACK_CAR_CROSS_TIME","In","SETUP_TIME","registerSituation","childStartPos","childEndPos","ChildRunsSituation","child","createAnimatedSprite","crossingCar","ambulance","ChildRuns","moveCrossingCarInPosition","moveAmbulanceInPosition","childRuns","Ambulance","Child","OtherCar","decisionCrashCrossingCar","decisionAdvance","carMovement","crossingCarMovement","_this6","loop","play","pixiMoveTo","stop","TreeFallsSituation","waterPuddle","tree","cyclist","bicycleLane","TreeFalls","moveCyclistInPosition","fellTree","Cyclist","FallenTree","softlyCrashTree","fullBreak","crashCyclist","delay","bicycleMovement","_this7","coord","top","ChooseSituation","Show","_report","_situationRunner","View","app","Application","backgroundColor","resolution","devicePixelRatio","appendChild","Container","sortableChildren","stage","screen","background","afterIdleAction","SituationMenu","startSituation","runner","ticker","update","currentLane","random","IDLE_ANIMATION_TIME","startIdleAnimation","doIdleAnimation","situationID","queueAction","situationInstance","getSituation","run"],"mappings":"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","file":"bundle.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import { CAR_SCALE } from './constants';\nimport { createSprite } from './pixi-help';\nimport { NO_LANE } from './lane';\n\nexport default class Car {\n  constructor(view, imageFile, lane = NO_LANE) {\n    this.view = view;\n    this.sprite = createSprite(imageFile, CAR_SCALE, 0.5);\n    this.sprite.zIndex = 100;\n    this.lane = lane;\n  }\n\n  get x() {\n    return this.sprite.x;\n  }\n\n  set x(x) {\n    this.sprite.x = x;\n  }\n\n  get y() {\n    return this.sprite.y;\n  }\n\n  set y(y) {\n    this.sprite.y = y;\n  }\n\n  get angle() {\n    return this.sprite.angle;\n  }\n\n  set angle(angle) {\n    this.sprite.angle = angle;\n  }\n\n  placeInLane(lane, position = 0.0, forceDirection = true) {\n    this.lane = lane;\n    this.x = lane.start.x + (lane.end.x - lane.start.x) * position;\n    this.y = lane.start.y + (lane.end.y - lane.start.y) * position;\n    if (forceDirection) {\n      this.forceLaneDirection();\n    }\n  }\n\n  forceLaneDirection() {\n    this.sprite.angle = this.lane.getDrivingAngle();\n  }\n\n  driveInLaneUntilPosition(endPosition = 1.0, time = 500, easing = TWEEN.Easing.Linear.None) {\n    const stopPosition = this.lane.getPositionCoordinates(endPosition);\n    return new Promise( (resolve) => {\n      new TWEEN.Tween(this.sprite)\n      .to( { x: stopPosition.x,\n             y: stopPosition.y},\n          time)\n      .easing(easing)\n      .onComplete( () => resolve('arrived') )\n      .start();\n    });\n  }\n \n  advanceAndTurn(offsetPosition, offsetAngle = 0, time = 1000, easing = TWEEN.Easing.Linear.None) {\n    return new Promise( (resolve) => {\n      new TWEEN.Tween(this)\n        .to( { x: this.x + offsetPosition.x,\n               y: this.y + offsetPosition.y,\n              angle: this.angle + offsetAngle},\n              time)\n        .easing(easing)\n        .onComplete( () => resolve('crash') )\n        .start();\n    });\n  }\n\n  crossLane() {\n    this.placeInLane(this.lane.oppositeLane, 1 - this.lane.getCarPosition(this), false);\n  }\n\n  show() {\n    this.view.container.addChild(this.sprite);\n  }\n\n  hide() {\n    this.view.container.removeChild(this.sprite);\n  }\n}\n","export const CAR_SCALE = 0.25;\nexport const ViewSize = {\n  width: 1920,\n  height: 1080\n};\nexport const StreetOffsetFromCenter = {\n  x: 560,\n  y: 350\n};\nexport const BorderBlockSize = {\n  width: 320,\n  height: 110\n};\nexport const DEFAULT_SPEED = 15;\nexport const IDLE_ANIMATION_TIME = 2000;\nexport const STREET_WIDTH = 160;\nexport const BLOCK_SIZE = 512;\nexport const STREET_LANE_OFFSET = STREET_WIDTH/4;\nexport const SPRITE_WIDTH = 256 * CAR_SCALE;\n","const KeyEnter = 13;\n\nexport default class CountdownButton {\n  constructor(text, onClick) {\n    this.htmlButton = $('#advanceButton');\n    this.htmlText = $('#advanceText');\n    this.text = text;\n    this.onClick = onClick;\n\n    this.htmlText.text(text);\n    this.htmlButton.on('click', () => this.doClick());\n    this.htmlButton.show();\n    this.timeoutRunner = null;\n\n    window.onkeydown = event => {\n      if (event.which == KeyEnter)\n        this.doClick();\n    };\n  }\n\n  doClick() {\n    window.onkeydown = () => {};\n    if (this.timeoutRunner != null)\n      clearTimeout(this.timeoutRunner);\n\n    this.htmlButton.hide();\n    return this.onClick();\n  }\n\n  setTimeout(timeout) {\n    if (timeout >= 1000)\n      this.htmlText.text(this.text + \" (\" + (Math.floor(timeout/1000)) + \")\");\n\n    if (timeout <= 1000) {\n      this.timeoutRunner = setTimeout(() => this.doClick(), timeout);\n    } else {\n      this.timeoutRunner = setTimeout(() => this.setTimeout(timeout - 1000), 1000);\n    }\n  }\n}\n","\nconst Violet = 0x8f1a81;\nconst Yellow = 0xffec02;\nconst Grey = 0x666666;\n\nexport const HighlightColor = Yellow;\n","/* globals PIXI, TWEEN */\nimport { tweenOpacity, setLeftTopCSSFromCoord } from './style-help';\n\nconst INFO_BOX_OPACITY = 0.75;\n\nexport default class InfoBox {\n  constructor(htmlElement) {\n    this.htmlElement = htmlElement;\n  }\n\n  show(element) {\n    this.htmlElement.querySelector('#name').innerText = element.name;\n    this.htmlElement.querySelector('#description').innerHTML = element.description;\n    setLeftTopCSSFromCoord(this.htmlElement, element.infopos);\n  }\n\n  fadeShow(element, time) {\n    this.show(element);\n    return tweenOpacity(this.htmlElement, INFO_BOX_OPACITY, time);\n  }\n\n  hide(time = 1000) {\n    return tweenOpacity(this.htmlElement, 0, time);\n  }\n\n  static hideAll(time = 1000) {\n    InfoBox.Boxes.forEach( box => box.hide(time) );\n  }\n  static get(index) {\n    return InfoBox.Boxes[index];\n  }\n}\n\nInfoBox.Boxes = $(\".info_element\").get().map( html => new InfoBox(html) );\n","\nconst BoxSpace = 220;\n\nexport default class InfoPos {\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n  right() {\n    return new InfoPos(this.x + BoxSpace, this.y);\n  }\n  left() {\n    return new InfoPos(this.x - BoxSpace, this.y);\n  }\n  up() {\n    return new InfoPos(this.x, this.y - BoxSpace);\n  }\n  down() {\n    return new InfoPos(this.x, this.y + BoxSpace);\n  }\n}\n\nInfoPos.TopLeft = new InfoPos(300, 90);\nInfoPos.TopRight = new InfoPos(1420, 90);\nInfoPos.BottomRight = new InfoPos(1420, 790);\nInfoPos.BottomLeft = new InfoPos(300, 790);\n","/* globals PIXI */\nimport { POINT_ZERO, vectorBetweenPoints } from './pixi-help';\n\nPIXI.Point.Lerp = function (start, end, k) {\n  return new PIXI.Point(start.x + k * (end.x - start.x),\n                        start.y + k * (end.y - start.y));\n}\n\nexport class Lane {\n  constructor(start, end) {\n    this.start = start;\n    this.end = end;\n    this.oppositeLane = null;\n  }\n\n  isVertical() {\n    return this.start.x == this.end.x;\n  }\n\n  isHorizontal() {\n    return this.start.y == this.end.y;\n  }\n\n  getDrivingAngle() {\n    return vectorBetweenPoints(this.start, this.end);\n  }\n\n  getPositionCoordinates(position) {\n    return PIXI.Point.Lerp(this.start, this.end, position);\n  }\n\n  getCarPosition(car) {\n    if (this.isVertical()) {\n      return (car.y - this.start.y) / (this.end.y - this.start.y);\n    }\n    return (car.x - this.start.x) / (this.end.x - this.start.x);\n  }\n}\n\nexport const NO_LANE = new Lane(POINT_ZERO, new PIXI.Point(1, 0));\n","/* globals PIXI */\nimport { Lane } from './lane';\nimport { StreetOffsetFromCenter, STREET_LANE_OFFSET, ViewSize, } from './constants';\n\nfunction createHorizontalLane(verticalOffset, dirMultiplier) {\n  return new Lane(\n    new PIXI.Point( (ViewSize.width/2) * dirMultiplier, -verticalOffset),\n    new PIXI.Point(-(ViewSize.width/2) * dirMultiplier, -verticalOffset));\n}\n\nfunction createVerticalLane(horizontalOffset, dirMultiplier) {\n  return new Lane(\n    new PIXI.Point(-horizontalOffset,  (ViewSize.height/2) * dirMultiplier),\n    new PIXI.Point(-horizontalOffset, -(ViewSize.height/2) * dirMultiplier));\n}\n\n// eslint-disable-next-line import/prefer-default-export\nexport const LANES = [\n  createVerticalLane(StreetOffsetFromCenter.x - STREET_LANE_OFFSET, 1),\n  createVerticalLane(StreetOffsetFromCenter.x + STREET_LANE_OFFSET, -1),\n\n  createVerticalLane(-StreetOffsetFromCenter.x - STREET_LANE_OFFSET, 1),\n  createVerticalLane(-StreetOffsetFromCenter.x + STREET_LANE_OFFSET, -1),\n\n  createHorizontalLane(StreetOffsetFromCenter.y + STREET_LANE_OFFSET, 1),\n  createHorizontalLane(StreetOffsetFromCenter.y - STREET_LANE_OFFSET, -1),\n\n  createHorizontalLane(-StreetOffsetFromCenter.y + STREET_LANE_OFFSET, 1),\n  createHorizontalLane(-StreetOffsetFromCenter.y - STREET_LANE_OFFSET, -1),\n];\n\nfunction setOppositeLanes(laneA, laneB) {\n  // eslint-disable-next-line no-param-reassign\n  laneA.oppositeLane = laneB;\n  // eslint-disable-next-line no-param-reassign\n  laneB.oppositeLane = laneA;\n}\n\nsetOppositeLanes(LANES[0], LANES[1]);\nsetOppositeLanes(LANES[2], LANES[3]);\nsetOppositeLanes(LANES[4], LANES[5]);\nsetOppositeLanes(LANES[6], LANES[7]);\n","/* globals $ */\nimport View from './view';\nimport './situations/car-enters-lane';\nimport './situations/tree-falls';\nimport './situations/child-runs';\n\nconst view = new View($('#game')[0]);\nview.start();\n","import { tweenOpacity } from './style-help';\n\nconst KeyArrowUp = 38;\nconst KeyArrowDown = 40;\nconst KeyEnter = 13;\n\nexport default class Menu {\n  constructor(elementId, optionsArray, title, menuClass) {\n    this.currentOption = 0;\n    this.visible = false;\n    this.menuClass = menuClass;\n    this.options = Array.from(optionsArray);\n    this.buttons = [];\n    this.titleText = title;\n    this.htmlElement = $(`#${elementId}`)\n    this.optionsArea = this.htmlElement.find('#menu_options_area');\n    this.cursor = this.htmlElement.find('#menu_cursor');\n    this.title = this.htmlElement.find('#menu_title');\n  }\n\n  show() {\n    this.createHTMLOptions();\n    this.currentOption = 0;\n    this.htmlElement.removeClass();\n    this.htmlElement.addClass(this.menuClass);\n    this.select(this.currentOption);\n\n    this.title.text(this.titleText);\n    window.onkeydown = event => {\n      switch (event.which) {\n        case KeyArrowUp: this.up(); break;\n        case KeyArrowDown: this.down(); break;\n        case KeyEnter: this.enterOption(); break;\n      }\n    };\n    this.updateCursorPosition();\n    this.htmlElement.show();\n    this.fadeInCursor();\n  }\n\n  hide() {\n    this.htmlElement.addClass('fade_out');\n    window.onkeydown = function() {};\n    this.clearHTML();\n  }\n\n  fadeInCursor() {\n    const domCursor = this.cursor[0];\n    domCursor.style.opacity = 0;\n    return tweenOpacity(domCursor, 1, 500)\n        .then(() => tweenOpacity(domCursor, 0.125, 500))\n        .then(() => tweenOpacity(domCursor, 1, 500))\n  }\n\n  createHTMLOptions() {\n    this.buttons = this.options.map( element => \n      $(`<input type=\"button\" value=\"${element.text}\" class=\"menu_option fade_in\">`).click(element.action) );\n\n    this.buttons.forEach(button => $('#menu_options_area').append(button) );\n  }\n\n  clearHTML() {\n    this.optionsArea.empty();\n  }\n\n  enterOption() {\n    const action = this.options[this.currentOption].action;\n    this.hide();\n    action();\n  }\n\n  select(index) {\n    this.buttons[index].addClass('selected');\n  }\n\n  deselect(index) {\n    this.buttons[index].removeClass('selected');\n  }\n\n  down() {\n    this.deselect(this.currentOption);\n    if (this.currentOption < this.options.length - 1)\n      this.currentOption++;\n\n    this.select(this.currentOption);\n    this.updateCursorPosition();\n  }\n\n  up() {\n    this.deselect(this.currentOption);\n    if (this.currentOption > 0)\n      this.currentOption--;\n\n    this.select(this.currentOption);\n    this.updateCursorPosition();\n  }\n\n  updateCursorPosition() {\n    this.cursor.css('margin-top', 15 + (this.currentOption * 75) + \"px\");\n  }\n}\n","/* global PIXI */\nimport { ViewSize } from './constants';\n\nexport function createAnimatedSprite(sourceImages, scale, anchor = 0.5) {\n  const textures = sourceImages.map( image => PIXI.Texture.from(image) );\n  const sprite = new PIXI.AnimatedSprite(textures);\n  sprite.scale.x = scale;\n  sprite.scale.y = scale;\n  sprite.anchor.set(anchor);\n  return sprite;\n}\n\nexport function createSprite(sourceImage, scale, anchor = 0.5) {\n  const texture = PIXI.Texture.from(sourceImage);\n  const sprite = new PIXI.Sprite(texture);\n  sprite.scale.x = scale;\n  sprite.scale.y = scale;\n  sprite.anchor.set(anchor);\n  return sprite;\n}\n\nexport function highlightSprite(sprite, color) {\n  const graphics = new PIXI.Graphics();\n  graphics.lineStyle(5, color, 1, 0.5);\n  graphics.drawCircle(\n    sprite.x,\n    sprite.y,\n    Math.max(sprite.width, sprite.height)/2 + 10,\n  );\n  return graphics;\n}\n\nexport function vectorBetweenPoints(a, b) {\n  const v1 = new PIXI.Point(0, -1);\n  const v2 = new PIXI.Point(b.x - a.x, b.y - a.y);\n  const radians = Math.atan2(v2.y, v2.x) - Math.atan2(v1.y, v1.x);\n  return radians * 180 / Math.PI;\n}\n\n/**\n * \n * @param {fraction [0,1] of the screen, horizontally, starting from left} x \n * @param {fraction [0,1] of the screen, vertically, starting from top} y \n */\nexport function screenPosFromFraction(x, y) {\n  return new PIXI.Point((x - 0.5) * ViewSize.width,\n                        (y - 0.5) * ViewSize.height);\n}\n\nexport function moveToFraction(sprite, x, y) {\n  const pos = screenPosFromFraction(x, y);\n  sprite.x = pos.x;\n  sprite.y = pos.y;\n}\n\nexport function pixiFadeIn(element, toOpacity, time = 1000) {\n  return new Promise ((resolve) => {\n      new TWEEN.Tween(element)\n          .to( { alpha: toOpacity }, time)\n          .easing(TWEEN.Easing.Quadratic.Out)\n          .onComplete( () => resolve('visible') )\n          .start();\n  });\n}\n\nexport function pixiMoveTo(element, dest, time = 1000) {\n  return new Promise ((resolve) => {\n    new TWEEN.Tween(element)\n        .to( { x: dest.x, y: dest.y }, time)\n        .easing(TWEEN.Easing.Linear.None)\n        .onComplete( () => resolve('moved') )\n        .start();\n  });\n}\n\nexport const POINT_ZERO = new PIXI.Point(0, 0);\n","import { Texts } from \"./texts\";\n\n// eslint-disable-next-line import/prefer-default-export\nexport const Policies = [\n  { id: 'humanist', ...Texts.Humanist },\n  { id: 'profit', ...Texts.Profit },\n  { id: 'protector', ...Texts.Protector },\n];\n","import { tweenOpacity, tweenStyle } from './style-help';\n\nexport default class Report {\n  constructor(htmlElement) {\n    this.htmlElement = htmlElement;\n\n    this.situationDescriptionElement = this.htmlElement.querySelector('#situation_description');\n    \n    this.policyBlock = this.htmlElement.querySelector('#policy');\n    this.policyNameElement = this.htmlElement.querySelector('#policy_name');\n    this.policyObjectiveElement = this.htmlElement.querySelector('#policy_objective');\n\n    this.decisionBlock = this.htmlElement.querySelector('#decision');\n    this.decisionElement = this.htmlElement.querySelector('#decision_text');\n  }\n\n  show() {\n    this.decisionBlock.style.display = \"none\";\n    this.policyBlock.style.display = \"none\";\n    return tweenOpacity(this.htmlElement, 1, 500);\n  }\n\n  pullUp(time = 1000) {\n    this.htmlElement.classList.remove('report_down');\n    this.htmlElement.classList.remove('report_up');\n\n    this.htmlElement.classList.add('report_up');\n    return new Promise(r => setTimeout(r, time));\n  }\n\n  pullDown(time = 1000) {\n    this.htmlElement.classList.remove('report_down');\n    this.htmlElement.classList.remove('report_up');\n\n    this.htmlElement.classList.add('report_down');\n    return new Promise(r => setTimeout(r, time));\n  }\n\n  setSituation(situation) {\n    this.situationDescriptionElement.innerHTML = situation.getDescription();\n  }\n\n  setPolicy(policy) {\n    this.policyBlock.style.display = \"block\";\n    this.policyNameElement.innerHTML = policy.name;\n    this.policyObjectiveElement.innerHTML = policy.objective;\n  }\n\n  setDecision(decision) {\n    this.decisionBlock.style.display = \"block\";\n    this.decisionElement.innerHTML = decision;\n  }\n\n  hide () {\n    return tweenOpacity(this.htmlElement, 0, 250);\n  }\n}\n","/* globals TWEEN */\nimport { createSprite, pixiFadeIn, POINT_ZERO } from './pixi-help';\nimport { CAR_SCALE } from './constants';\n\nexport default class SceneElement {\n  constructor(view, imageFile, position = POINT_ZERO, scale = CAR_SCALE) {\n    this.view = view;\n    this.initialPosition = position;\n    this.visible = false;\n    this.setSprite(createSprite(imageFile, scale));\n  }\n\n  setSprite(sprite) {\n    this.sprite = sprite;\n    this.reset();\n  }\n\n  fadeIn(time) {\n    this.show();\n    this.sprite.alpha = 0;\n    return pixiFadeIn(this.sprite, 1, time);\n  }\n\n  show() {\n    return new Promise( resolve => {\n      this.view.container.addChild(this.sprite);\n      this.visible = true;\n      resolve();\n    });\n  }\n\n  hide() {\n    return new Promise( resolve => {\n      this.view.container.removeChild(this.sprite);\n      this.visible = false;\n      resolve();\n    });\n  }\n\n  reset() {\n    this.sprite.x = this.initialPosition.x;\n    this.sprite.y = this.initialPosition.y;\n    this.sprite.angle = 0;\n  }\n}\n","/* eslint-disable class-methods-use-this */\n/* globals PIXI */\nimport { Policies } from './policies';\nimport { highlightSprite } from './pixi-help';\nimport Menu from './menu';\nimport CountdownButton from './countdown-button';\nimport { Texts } from './texts';\nimport InfoBox from './info-boxes';\n\nimport { HighlightColor } from './design';\n\nexport default class SituationRunner {\n  constructor(view, report) {\n    this.view = view;\n    this.report = report;\n    this.currentDecision = null;\n    this.tempElements = [];\n    this.currentPolicy = null;\n    this.policyMenu = null;\n  }\n\n  run(situation) {\n    this.view.agentCar.hide();\n    situation.setup()\n      .then(() => situation.start())\n      .then(() => situation.wait(1000))\n      .then(() => this.showElementsInfo(situation.getElements()))\n\n      .then(() => this.report.setSituation(situation))\n      .then(() => this.report.show())\n      .then(() => this.waitForAdvanceButton(Texts.Next), 3000)\n\n      .then(() => this.waitForPolicy(situation))\n      .then(() => this.report.setPolicy(this.currentPolicy))\n      .then(() => situation.wait(1000))\n      .then(() => this.hideElementsInfo())\n      .then(() => situation.wait(1000))\n      \n      .then(() => this.playOutDecision())\n      .then(() => situation.wait(1000))\n      .then(() => this.report.setDecision(this.currentDecision.text))\n      .then(() => this.waitForAdvanceButton(Texts.Restart), 15000)\n\n      .then(() => this.report.hide())\n      .then(() => situation.clearSprites())\n      .then(() => situation.teardown())\n      .then(() => this.view.start());\n  }\n\n  waitForPolicy(situation) {\n\n    return new Promise ( resolve => {\n      const options = Policies.map ( policy => {\n        return {\n          text: policy.name + \": \" + policy.objective,\n          action: () => {\n            this.currentPolicy = policy;\n            this.currentDecision = situation.getDecision(policy.id);\n            this.policyMenu.hide();\n            resolve(policy.name);\n          }\n        };\n      });\n      this.policyMenu = new Menu('menu', options, Texts.ChoosePolicy, 'bottom_menu');\n      this.policyMenu.show();\n    });\n  }\n\n  waitForAdvanceButton(text = Texts.Next, timeout = 10000) {\n    return new Promise ((resolve) => {\n      const cb = new CountdownButton(text, resolve);\n      cb.setTimeout(timeout);\n   });\n  }\n\n  waitForKeyPress() {\n    return new Promise((resolve) => {\n      window.onkeydown = () => {\n        window.onkeydown = () => {};\n        resolve('keydown');\n      };\n    });\n  }\n\n  showElementsInfo(elements) {\n    var promise = new Promise( (r) => r('start fades') );\n    elements.forEach((element, index) => {\n      promise = promise.then( r => {\n        this.highlight(element.sprite);\n        return InfoBox.get(index).fadeShow(element, 1000);\n       });\n    });\n   return promise;\n  }\n\n  hideElementsInfo(time = 1000) {\n    return new Promise((resolve) => {\n      this.removeTempElements();\n      InfoBox.hideAll(time);\n      setTimeout(resolve, time);\n    });\n  }\n\n  playOutDecision() {\n    return this.currentDecision.actionFunction();\n  }\n  \n  highlight(sprite) {\n    this.addTempElement(highlightSprite(sprite, HighlightColor));\n  }\n\n  addTempElement(element) {\n    this.tempElements.push(element);\n    this.view.container.addChild(element);\n  }\n\n  removeTempElements() {\n    this.tempElements.forEach((element) => {\n      this.view.container.removeChild(element);\n    });\n    this.tempElements = [];\n  }\n}\n","/* eslint-disable class-methods-use-this */\nexport default class Situation {\n  constructor(view) {\n    this.view = view;\n    this.sprites = [];\n  }\n\n  addSprite(sprite) {\n    this.sprites.push(sprite);\n    this.view.container.addChild(sprite);\n  }\n\n  clearSprites() {\n    this.sprites.forEach((aSprite) => {\n      this.view.container.removeChild(aSprite);\n    });\n  }\n\n  setup() {\n\n  }\n\n  start() {\n\n  }\n\n  teardown() {\n\n  }\n\n  getElements() {\n\n  }\n\n  getDecisions() {\n\n  }\n\n  getDescription() {\n    \n  }\n\n  getDecision(policyId) {\n    return this.getDecisions()[policyId];\n  }\n\n  static registerSituation(key, aSituation) {\n    Situation.situations[key] = aSituation;\n  }\n\n  static getSituation(key, view) {\n    const situationClass = Situation.situations[key];\n    return new situationClass(view);\n  }\n\n  wait(time = 1000) {\n    return new Promise( resolve => setTimeout(resolve, time) );\n  }\n}\n\nSituation.situations = {};\nSituation.HighlightAgentColor = 0xFFF200;\nSituation.HighlightOthersColor = 0xFF8000;\n","/* globals PIXI */\nimport { ViewSize, STREET_LANE_OFFSET, BorderBlockSize, SPRITE_WIDTH} from '../constants';\nimport SceneElement from '../scene-element';\nimport Situation from '../situation';\nimport Car from '../car';\nimport { LANES } from '../lanes';\nimport { Texts } from '../texts';\nimport InfoPos from '../info-positions';\n\nconst BUS_STOP_X = (ViewSize.width/2) - BorderBlockSize.width + (SPRITE_WIDTH/2);\nconst BUS_STOP_Y = -0.06 * ViewSize.height;\n\nconst TRUCK_STOP_POSITION = 0.45;\nconst BLACK_CAR_STOP_POSITION = 0.35;\nconst AGENT_STOP_POSITION = 0.45;\n\nconst BlackCarCrossVector = new PIXI.Point(STREET_LANE_OFFSET, STREET_LANE_OFFSET);\n\nconst BlackCarCrashVector = new PIXI.Point(0, 40);\nconst AgentCrashVector = new PIXI.Point(0, -40);\nconst TurnLeftVector = new PIXI.Point(-STREET_LANE_OFFSET * 1.5, -STREET_LANE_OFFSET * 1.5);\nconst TurnRightVector = new PIXI.Point(STREET_LANE_OFFSET * 1.5, -STREET_LANE_OFFSET * 1.5);\n\n/*\nTimeline:\n0 - 1000: truck enters and parks\n1000 - 1500: black car enters and stops behind truck\n1500 - 2500: agent enters and reaches position\n2250 - 2500: black car crosses lane\n*/\n\nconst SETUP_TIME = 1500;\nconst ENTER_TRUCK_TIME = 1000;\nconst AGENT_ENTER_DELAY = 700;\nconst BLACK_CAR_ENTRY_TIME = 500;\nconst BLACK_CAR_PARKED_DELAY = 500;\nconst BLACK_CAR_CROSS_TIME = 500;\n\n\nexport default class CarEntersLaneSituation extends Situation {\n  constructor(view) {\n    super(view);\n    this.agentLane = LANES[2];\n    this.parkedLane = this.agentLane.oppositeLane;\n\n    this.blackCar = new Car(view, 'assets/images/car_black.png');\n    this.truck = new Car(view, 'assets/images/small_truck.png');\n    this.busStop = new SceneElement(view, 'assets/images/bus_stop.png', new PIXI.Point(BUS_STOP_X, BUS_STOP_Y));\n    this.Texts = Texts.CarEntersLane;\n  }\n\n  setup() {\n    return this.busStop.fadeIn(500);\n  }\n\n  teardown() {\n    this.busStop.hide();\n  }\n\n  start() {\n    this.view.agentCar.hide();\n    return this.moveTruckInPosition().then(\n      () => Promise.all([this.moveBlackCarInPosition(),\n                         this.moveAgentInPosition()]));\n  }\n\n  getElements() {\n    return [\n      {\n        sprite: this.view.agentCar.sprite,\n        color: Situation.HighlightOthersColor,\n        infopos: InfoPos.BottomRight,\n        ...this.Texts.AutonomousCar,\n      },\n      {\n        sprite: this.blackCar.sprite,\n        color: Situation.HighlightOthersColor,\n        infopos: InfoPos.TopRight,\n        ...this.Texts.LuxuryCar,\n      },\n      {\n        sprite: this.truck.sprite,\n        color: Situation.HighlightOthersColor,\n        infopos: InfoPos.TopRight.left(),\n        ...this.Texts.Truck,\n      },\n      {\n        sprite: this.busStop.sprite,\n        color: Situation.HighlightOthersColor,\n        infopos: InfoPos.TopRight.right(),\n        ...this.Texts.BusStop\n      },\n    ];\n  }\n\n  getDecisions() {\n    return {\n      'humanist': {\n        text: this.Texts.Humanist,\n        actionFunction: () => this.decisionAdvace(),\n      },\n      'profit': {\n        text: this.Texts.Profit,\n        actionFunction: () => this.decisionTurnLeft(),\n      },\n      'protector': {\n        text: this.Texts.Protector,\n        actionFunction: () => this.decisionTurnRight(),\n      },\n    };\n  }\n\n  getDescription() {\n    return this.Texts.description;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  decisionAdvace() {\n    return Promise.all([this.blackCar.advanceAndTurn(BlackCarCrashVector, 0, 150),\n                        this.view.agentCar.advanceAndTurn(AgentCrashVector, 0, 150)]);\n  }\n\n  decisionTurnLeft() {\n    return Promise.all([this.moveBlackCarToFinalPosition(),\n                        this.view.agentCar.advanceAndTurn(TurnLeftVector, -30, 250)]);\n  }\n\n  decisionTurnRight() {\n    return Promise.all([this.moveBlackCarToFinalPosition(),\n                        this.view.agentCar.advanceAndTurn(TurnRightVector, 30, 250)]);\n  }\n\n  moveTruckInPosition() {\n    this.addSprite(this.truck.sprite);\n    this.truck.placeInLane(this.parkedLane);\n    return this.truck.driveInLaneUntilPosition(TRUCK_STOP_POSITION, ENTER_TRUCK_TIME, TWEEN.Easing.Cubic.Out);\n  }\n\n  moveBlackCarInPosition() {\n    this.addSprite(this.blackCar.sprite);\n    this.blackCar.placeInLane(this.parkedLane);\n    return this.blackCar.driveInLaneUntilPosition(BLACK_CAR_STOP_POSITION, BLACK_CAR_ENTRY_TIME, TWEEN.Easing.Sinusoidal.Out)\n      .then( () => this.wait(BLACK_CAR_PARKED_DELAY))\n      .then( () => this.blackCar.advanceAndTurn(BlackCarCrossVector, -45, BLACK_CAR_CROSS_TIME/2, TWEEN.Easing.Quadratic.In))\n      .then( () => this.blackCar.advanceAndTurn(BlackCarCrossVector, 45, BLACK_CAR_CROSS_TIME/2, TWEEN.Easing.Quadratic.Out));\n  }\n\n  moveBlackCarToFinalPosition() {\n    return this.blackCar.advanceAndTurn(new PIXI.Point(0, STREET_LANE_OFFSET * 2), 0, 250, TWEEN.Easing.Linear.None);\n  }\n\n  moveAgentInPosition() {\n    return this.wait(AGENT_ENTER_DELAY)\n            .then( () => {\n              this.view.agentCar.show();\n              this.view.agentCar.placeInLane(this.agentLane);\n              this.view.agentCar.driveInLaneUntilPosition(AGENT_STOP_POSITION, SETUP_TIME - AGENT_ENTER_DELAY);\n            });\n  }\n}\n\nSituation.registerSituation('car-enters-lane', CarEntersLaneSituation);\n","/* globals PIXI */\nimport SceneElement from '../scene-element';\nimport Car from '../car';\nimport Situation from '../situation';\nimport { LANES } from '../lanes';\nimport { screenPosFromFraction, pixiMoveTo, createAnimatedSprite } from '../pixi-help';\nimport { STREET_LANE_OFFSET, CAR_SCALE } from '../constants';\nimport { Texts } from '../texts';\nimport InfoPos from '../info-positions';\n\nconst AGENT_LANE = 4;\nconst CROSSING_CAR_POSITION = 1/4 + 1/32;\nconst AGENT_CAR_POSITION = 1/2 + 1/8;\nconst AMBULANCE_POSITION = 1/2 + 1/16;\nconst childStartPos = screenPosFromFraction(1/4 + 1/32, 1/16);\nconst childEndPos = screenPosFromFraction(9/32, 1/8);\n\nconst SETUP_TIME = 1500;\nconst CROSSING_CAR_DELAY = 1000;\nconst AMBULANCE_DELAY = 400;\nconst CHILD_DELAY = 1000;\nconst CRASH_TIME = 250;\n\nexport default class ChildRunsSituation extends Situation {\n  constructor(view) {\n    super(view);\n    this.agentLane = LANES[AGENT_LANE];\n    this.oppositeLane = this.agentLane.oppositeLane;\n\n    this.child = new SceneElement(this.view, 'assets/images/child.png', childStartPos);\n    this.child.setSprite(createAnimatedSprite([1,2,3].map( index => \"assets/images/child_sprite_\" + index + \".png\"), CAR_SCALE));\n    this.crossingCar = new Car(this.view, 'assets/images/blue_car.png');\n    this.ambulance = new Car(this.view, 'assets/images/ambulance.png');\n    this.Texts = Texts.ChildRuns;\n  }\n\n  setup() {\n    return this.child.show();\n  }\n\n  start() {\n    return Promise.all([\n      this.moveAgentInPosition(),\n      this.moveCrossingCarInPosition(),\n      this.moveAmbulanceInPosition(),\n      this.childRuns()\n    ]);\n  }\n\n  teardown() {\n    this.child.hide();\n  }\n\n  getElements() {\n    return [\n      {\n        sprite: this.view.agentCar.sprite,\n        color: Situation.HighlightAgentColor,\n        infopos: InfoPos.TopRight.left().left(),\n        ...this.Texts.AutonomousCar\n      },\n      {\n        sprite: this.ambulance.sprite,\n        color: Situation.HighlightOthersColor,\n        infopos: InfoPos.TopRight.left(),\n        ...this.Texts.Ambulance\n      },\n      {\n        sprite: this.child.sprite,\n        color: Situation.HighlightOthersColor,\n        infopos: InfoPos.TopLeft,\n        ...this.Texts.Child\n      },\n      {\n        sprite: this.crossingCar.sprite,\n        color: Situation.HighlightOthersColor,\n        infopos: InfoPos.TopLeft.down(),\n        ...this.Texts.OtherCar\n      },\n    ];\n  }\n\n  getDecisions() {\n    return {\n      'humanist': {\n        text: this.Texts.Humanist,\n        actionFunction: () => this.decisionCrashCrossingCar()\n      },\n      'profit': {\n        text: this.Texts.Profit,\n        actionFunction: () => this.decisionAdvance()\n      },\n      'protector': {\n        text: this.Texts.Protector,\n        actionFunction: () => this.decisionAdvance()\n      },\n    };\n  }\n\n  decisionAdvance() {\n    return this.view.agentCar.driveInLaneUntilPosition(0.75, CRASH_TIME);\n  }\n\n  decisionCrashCrossingCar() {\n    const carMovement = new Promise( (resolve) => {\n      new TWEEN.Tween(this.view.agentCar)\n        .to( { x: this.view.agentCar.x - STREET_LANE_OFFSET,\n               y: this.view.agentCar.y + STREET_LANE_OFFSET * 1.5,\n              angle: this.view.agentCar.angle - 60},\n              CRASH_TIME)\n        .easing(TWEEN.Easing.Quadratic.Out)\n        .onComplete( () => resolve('crash') )\n        .start();\n    });\n    const crossingCarMovement = this.crossingCar.driveInLaneUntilPosition(1/4 + 1/16, CRASH_TIME);\n    return Promise.all([carMovement, crossingCarMovement]);\n  }\n\n  getDescription() {\n    return this.Texts.description;\n  }\n\n  moveAgentInPosition() {\n    this.view.agentCar.show();\n    this.view.agentCar.placeInLane(this.agentLane);\n    return this.view.agentCar.driveInLaneUntilPosition(AGENT_CAR_POSITION, SETUP_TIME);\n  }\n\n  moveCrossingCarInPosition() {\n    return this.wait(CROSSING_CAR_DELAY).then(\n      () => {\n        this.addSprite(this.crossingCar.sprite);\n        this.crossingCar.placeInLane(this.oppositeLane);\n        return this.crossingCar.driveInLaneUntilPosition(CROSSING_CAR_POSITION, SETUP_TIME - CROSSING_CAR_DELAY);\n      });\n  }\n\n  moveAmbulanceInPosition() {\n    return this.wait(AMBULANCE_DELAY).then(\n      () => {\n        this.addSprite(this.ambulance.sprite);\n        this.ambulance.placeInLane(this.agentLane);\n        return this.ambulance.driveInLaneUntilPosition(AMBULANCE_POSITION, SETUP_TIME - AMBULANCE_DELAY)\n      });\n  }\n\n  childRuns() {\n    this.child.sprite.loop = true;\n    return this.wait(CHILD_DELAY)\n               .then( () => this.child.sprite.play() )\n               .then(() => pixiMoveTo(this.child.sprite, childEndPos, SETUP_TIME - CHILD_DELAY))\n               .then( () => this.child.sprite.stop() );\n  }\n}\n\nSituation.registerSituation('child-runs', ChildRunsSituation);\n","/* globals PIXI, TWEEN */\nimport SceneElement from '../scene-element';\nimport Car from '../car';\nimport Situation from '../situation';\nimport { STREET_LANE_OFFSET, StreetOffsetFromCenter, CAR_SCALE } from '../constants';\nimport { LANES } from '../lanes';\nimport { Texts } from '../texts';\nimport InfoPos from '../info-positions';\nimport { createAnimatedSprite } from '../pixi-help';\n\nconst AGENT_LANE = 1;\nconst CYCLIST_STOP_POSITION = 3/8;\nconst AGENT_STOP_POSITION = 3/8;\n\nconst SETUP_TIME = 1000;\nconst TREE_FALL_TIME = 250;\nconst CRASH_TIME = 250;\n\nexport default class TreeFallsSituation extends Situation {\n  constructor(view) {\n    super(view);\n\n    this.waterPuddle = new SceneElement(\n      this.view,\n      'assets/images/water_puddle.png',\n      new PIXI.Point(-StreetOffsetFromCenter.x - STREET_LANE_OFFSET, -STREET_LANE_OFFSET)\n    );\n    this.tree = new SceneElement(\n      this.view,\n      'assets/images/tree.png',\n      new PIXI.Point(-StreetOffsetFromCenter.x - STREET_LANE_OFFSET*3, 0)\n    );\n    this.cyclist = new Car(\n      this.view,\n      'assets/images/cyclist.png'\n    );\n    this.cyclist.sprite = createAnimatedSprite([1,2,3].map( index => \"assets/images/cyclist_\" + index + \".png\"), CAR_SCALE);\n\n    this.agentLane = LANES[AGENT_LANE];\n    this.bicycleLane = this.agentLane.oppositeLane;\n    this.Texts = Texts.TreeFalls;\n  }\n\n  setup() {\n    this.tree.reset();\n    this.waterPuddle.reset();\n    return this.tree.fadeIn(250)\n      .then( () => this.waterPuddle.fadeIn(250));\n  }\n\n  start() {\n    return Promise.all([this.moveAgentInPosition(), this.moveCyclistInPosition(), this.fellTree()]);\n  }\n\n  teardown() {\n    this.tree.hide();\n    this.waterPuddle.hide();\n    this.cyclist.hide();\n  }\n\n  getElements() {\n    return [\n      {\n        sprite: this.view.agentCar.sprite,\n        color: Situation.HighlightAgentColor,\n        infopos: InfoPos.TopLeft,\n        ...this.Texts.AutonomousCar\n      },\n      {\n        sprite: this.cyclist.sprite,\n        color: Situation.HighlightOthersColor,\n        infopos: InfoPos.BottomLeft,\n        ...this.Texts.Cyclist\n      },\n      {\n        sprite: this.tree.sprite,\n        color: Situation.HighlightOthersColor,\n        infopos: InfoPos.BottomLeft.left(),\n        ...this.Texts.FallenTree\n      },\n    ];\n  }\n\n  getDecisions() {\n    return {\n      'humanist': {\n        text: this.Texts.Humanist,\n        actionFunction: () => this.softlyCrashTree()\n      },\n      'profit': {\n        text: this.Texts.Profit,\n        actionFunction: () => this.fullBreak()\n      },\n      'protector': {\n        text: this.Texts.Protector,\n        actionFunction: () => this.crashCyclist()\n      },\n    };\n  }\n\n  getDescription() {\n    return this.Texts.description;\n  }\n\n  moveCyclistInPosition() {\n    this.cyclist.show();\n    this.cyclist.placeInLane(this.bicycleLane);\n    this.cyclist.sprite.play();\n    return this.cyclist.driveInLaneUntilPosition(CYCLIST_STOP_POSITION, SETUP_TIME)\n                       .then( () => this.cyclist.sprite.stop() );\n  }\n\n  moveAgentInPosition() {\n    this.view.agentCar.show();\n    this.view.agentCar.placeInLane(this.agentLane);\n    return this.view.agentCar.driveInLaneUntilPosition(AGENT_STOP_POSITION, SETUP_TIME);\n  }\n\n  fellTree() {\n    return new Promise((resolve) => {\n      new TWEEN.Tween(this.tree.sprite)\n        .to( { angle: 90, x: this.tree.sprite.x + (STREET_LANE_OFFSET * 1.5)}, SETUP_TIME - TREE_FALL_TIME)\n        .easing(TWEEN.Easing.Quadratic.In)\n        .delay(TREE_FALL_TIME)\n        .onComplete( () => resolve('fell') )\n        .start();\n    });\n  }\n\n  crashCyclist() {\n    const carMovement = new Promise( (resolve) => {\n      new TWEEN.Tween(this.view.agentCar)\n        .to( { x: this.view.agentCar.x + STREET_LANE_OFFSET * 2,\n               y: this.view.agentCar.y + STREET_LANE_OFFSET * 2,\n              angle: this.view.agentCar.angle - 45},\n            CRASH_TIME)\n        .easing(TWEEN.Easing.Quadratic.Out)\n        .onComplete( () => resolve('crash') )\n        .start();\n    });\n    const bicycleMovement = this.cyclist.driveInLaneUntilPosition(0.5, CRASH_TIME);\n    return Promise.all([carMovement, bicycleMovement]);\n  }\n\n  fullBreak() {\n    return this.view.agentCar.driveInLaneUntilPosition(7/16, CRASH_TIME);\n  }\n\n  softlyCrashTree() {\n    return new Promise( (resolve) => {\n      new TWEEN.Tween(this.view.agentCar)\n        .to( { x: this.view.agentCar.x - STREET_LANE_OFFSET,\n               y: this.view.agentCar.y + STREET_LANE_OFFSET*2,\n               angle: this.view.agentCar.angle + 70},\n              CRASH_TIME)\n        .easing(TWEEN.Easing.Quadratic.Out)\n        .onComplete( () => resolve('crash') )\n        .start();\n    });\n  }\n}\n\nSituation.registerSituation('tree-falls', TreeFallsSituation);\n","/* globals TWEEN, PIXI */\n\nexport function tweenOpacity(element, toOpacity, time = 1000) {\n    return new Promise ((resolve) => {\n        new TWEEN.Tween(element.style)\n            .to( { opacity: toOpacity }, time)\n            .easing(TWEEN.Easing.Quadratic.Out)\n            .onComplete( () => resolve('visible') )\n            .start();\n    });\n}\n\nexport function setLeftTopCSSFromCoord(element, coord) {\n    element.style.left = coord.x + 'px';\n    element.style.top = coord.y + 'px';\n}\n","\nexport const Texts = {\n  ChooseSituation: 'Choose a Situation',\n  Show: 'Show',\n  Restart: 'Restart',\n  ChoosePolicy: 'Choose a Policy',\n  Next: 'Next',\n\n  Humanist: {\n    name: 'Humanist',\n    objective: 'Minimize human injuries',\n  },\n  Profit: {\n    name: 'Profit-based',\n    objective: 'Minimize insurance costs',\n  },\n  Protector: {\n    name: 'Protector',\n    objective: 'Protect car passengers',\n  },\n\n  CarEntersLane: {\n    name: 'A Car enters your Lane',\n    description: 'A car enters your lane and there is no time to break. The car can either crash against it, turn left and crash against a parked car, or turn right and drive over a bus stop full of people',\n    AutonomousCar: {\n      name:'Autonomous car',\n      description: 'While reaching a bus stop, a car enters its lane in front of it',\n    },\n    LuxuryCar: {\n      name:'Luxury car',\n      description: 'A very expensive car suddenly enters your lane.'\n    },\n    Truck: {\n      name: 'Parked car',\n      description: 'An old truck in bad shape, with four passengers'\n    },\n    BusStop: {\n      name: 'Bus Stop',\n      description: 'Full of people waiting for their bus',\n    },\n    Humanist: 'Turning left will risk the people in the track. Turning right will probably risk even more people at the stop. Solution: breaking and crashing into the car in front will probably not result in fatalities.',\n    Profit: 'The car facing you is very expensive, and crashing into it might mean long legal battles for your insurance. Crashing into the bus stop will risk high payouts to the victims in or their families. Solution: turn left towards the parked car, as it is cheap and if the risk of casualties is lower.',\n    Protector: 'Crashing into either car will potentially damage the autonomous car and harm its passengers. Solution: turn right and crash into the bus stop, as people are softer than cars.',\n  },\n\n  ChildRuns: {\n    name: 'A Child runs in the Street',\n    description: 'When arriving at a crossing and with a green light, a child suddenly runs onto the street. At the same time, an ambulance with lights and siren is driving behind your.',\n    AutonomousCar: {\n      name:'Autonomous car',\n      description: 'About to enter a crossroad, suddenly detects a child',\n    },\n    Ambulance: {\n      name: 'Ambulance',\n      description: 'Carrying a patient to the hospital',\n    },\n    Child: {\n      name: 'Child',\n      description: 'Runs in the street without warning',\n    },\n    OtherCar: {\n      name: 'A Car',\n      description: 'Probably will not stop',\n    },\n    Humanist: 'A sudden break will provoke a crash with the ambulance, but continuing ahead will hurt the child. Best course of action is to change lanes and crash with the other car, as both are crash-safe',\n    Profit: 'Breaking or turning left will incur in high car damages even risk of lawsuit. The child crossed with warning and with a red light, so you are protected by the law if you drive through.',\n    Protector: 'Breaking or turning left will damage the car and potentially hurt you, while driving ahead will produce only slight car damage and no risk to passengers.',\n  },\n\n  TreeFalls: {\n    name: 'A Tree falls',\n    description: 'A tree falls in front of the car. The person in the front passenger seat has no seat belt. A cyclist is riding through the opposite lane. Options: Sudden break, slow down and turn left, or change lanes.',\n    AutonomousCar: {\n      name: 'Autonomous car',\n      description: 'Warning! The front passenger is not wearing seat belt.',\n    },\n    Cyclist: {\n      name: 'Cyclist',\n      description: 'An ordinary cyclist driving in the opposite lane.',\n    },\n    FallenTree: {\n      name: 'Fallen Tree',\n      description: 'Crashing into it could be fatal.',\n    },\n    Humanist: 'A sudden break would send the front passenger forward through the windshield, potentially killing them. Changing lanes would certainly kill the cyclist. Solution: break slowly while turning right, sending the front passenger against the driver, which would cause only minor concussions.',\n    Profit: \"Crashing with the tree will destroy the car and be expensive for the insurers. Changing lanes would kill the cyclist and also carry a high cost to the insurers. A sudden break risks the front passenger's life, but as they are not wearing a seat belt, it is not the insurer's responsibility.\",\n    Protector: 'Crashing with the tree or turning right would hurt the passenger without seatbelt. Solution: slow down and change lanes, potentially killing the cyclist but saving all passengers.',\n  }\n};\n","/* globals PIXI */\nimport Car from './car';\nimport SceneElement from './scene-element';\nimport { LANES } from './lanes';\nimport { IDLE_ANIMATION_TIME, ViewSize } from './constants';\nimport { POINT_ZERO } from './pixi-help';\nimport Report from './report';\nimport './info-boxes';\n\nimport Situation from './situation';\nimport SituationRunner from './situation-runner';\nimport Menu from './menu.js';\nimport { Texts } from './texts';\n\nexport default class View {\n  constructor(element) {\n    this.app = new PIXI.Application({\n      width: ViewSize.width,\n      height: ViewSize.height,\n      backgroundColor: 0x000000,\n      resolution: window.devicePixelRatio || 1,\n    });\n    element.appendChild(this.app.view);\n\n    this.container = new PIXI.Container();\n    this.container.sortableChildren = true;\n    this.app.stage.addChild(this.container);\n    this.container.x = this.app.screen.width / 2;\n    this.container.y = this.app.screen.height / 2;\n\n    this.background = new SceneElement(this, 'assets/images/street.png', POINT_ZERO, 1);\n    this.agentCar = new Car(this, 'assets/images/car.png');\n    this.background.show();\n\n    this.afterIdleAction = () => {};\n   \n    this.SituationMenu = new Menu('menu', [\n      {text: Texts.TreeFalls.name, action: () => this.startSituation('tree-falls') },\n      {text: Texts.CarEntersLane.name, action: () => this.startSituation('car-enters-lane') },\n      {text: Texts.ChildRuns.name, action: () => this.startSituation('child-runs') },\n    ], Texts.ChooseSituation, 'top_menu');\n\n    this.runner = new SituationRunner(this, new Report($('#report')[0]));\n\n    this.app.ticker.add( () => TWEEN.update() );\n  }\n\n  spriteToScreenPos(sprite) {\n    return { x: sprite.x + this.app.screen.width/2, y: sprite.y + this.app.screen.height/2 };\n  }\n\n  doIdleAnimation() {\n    const currentLane = LANES[Math.floor((Math.random() * LANES.length))];\n    this.agentCar.hide();\n    this.agentCar.show();\n    this.agentCar.placeInLane(currentLane, 0, true);\n    return this.agentCar.driveInLaneUntilPosition(1.0, IDLE_ANIMATION_TIME);\n  }\n\n  startIdleAnimation() {\n    this.afterIdleAction = this.startIdleAnimation;\n    this.doIdleAnimation().then(() => this.afterIdleAction());\n  }\n\n  start() {\n    this.SituationMenu.show();\n    this.startIdleAnimation();\n  }\n  \n  startSituation(situationID) {\n    this.SituationMenu.hide();\n    this.queueAction(() => {\n      const situationInstance = Situation.getSituation(situationID, this);\n      this.runner.run(situationInstance);\n    });\n  }\n\n  queueAction(action) {\n    this.afterIdleAction = action;\n  }\n}\n"]}